DROP VIEW `vw_total_operation_by_daymonth`;--> statement-breakpoint
CREATE VIEW `vw_total_operation_by_daymonth` AS with "expenses_by_daymonth" as (select date(date, 'unixepoch') as "date", CAST(SUM(value) AS INTEGER) as "total_expense" from "vw_expense" where date >= date('now', 'start of month') AND date <= date('now') group by date), "incomes_by_daymonth" as (select date(date, 'unixepoch') as "date", CAST(SUM(value) AS INTEGER) as "total_income" from "vw_income" where date >= date('now', 'start of month') AND date <= date('now') group by date) select COALESCE(expenses_by_daymonth.date, incomes_by_daymonth.date) as "date", IFNULL("total_income", 0) as "total_income", IFNULL("total_expense", 0) as "total_expense", (IFNULL("total_income", 0) - IFNULL("total_expense", 0)) as "balance" from "expenses_by_daymonth" full join "incomes_by_daymonth" on expenses_by_daymonth.date = incomes_by_daymonth.date order by dia desc;